## Lab_3: Вступ до моніторингу.
### Pre-requirements:
- середовище з інстальованим Python / pip / pipenv;
- будь-який WEB-браузер;

### What to do.
1. Створіть папку з назвою лабораторної роботи у власному репозиторію. Перейшовши у папку ініціалізуйте середовище `pipenv` та встановіть необхідні пакети:
    ```bash
    pipenv --python 3.7
    pipenv install django
    ```
1. За допомогою Django Framework створіть заготовку (template) Вашого проекту  (у мене назва my_site, Ви можете назвати його по іншому). Для зручності винесіть всі створені файли на один рівень вище щоб структура проекту була такою як показано нижче: 
    ```bash
    pipenv run django-admin startproject my_site
    
    mv my_site/my_site/* my_site/
    mv my_site/manage.py ./
    ```
    ```text
    lab3/
    ├── my_site/
    │   ├── __init__.py
    │   ├── settings.py
    │   ├── urls.py
    │   └── wsgi.py
    └── manage.py
    ```
1. Переконайтесь що все встановилось правильно і Ви можете запустити Django сервер. Виконайте команду вказану нижче та перейдіть за посиланням яке вивелось у консолі (згідно дефолтних налаштувань потрібно перейти на localhost:8000):
    ```bash
    pipenv run python manage.py runserver
    ```
1. Якщо все запустилось успішно і стартова сторінка Django відображається коректно, зупиніть сервер виконавши переривання `Ctrl+C`. Створіть коміт із базовим темплейтом сайту. За бажанням ознайомтесь із функціоналом [Django Framework](https://www.djangoproject.com/);
    > Після запуску сервера у поточні папці також створиться файл бези даних (`db.sqlite3`) який не потрібно комітити в репозиторій.
1. Далі створіть темплейт Вашого додатку (app) у якому буде описано всі web сторінки Вашого сайту (я назвав додаток main). Створіть коміт із новоствореними файлами темплейту додатка:
    ```bash
    pipenv run python manage.py startapp main
    ```
1. До даного кроку у Вашому репозиторію повинно бути всі базові темплейти Django та файли віртуального середовища. Використовуючи можливості IntelliJ створіть папку `main/templates/`, а також у даній папці файл з розширенням `.html` (`main.html`). Також у папці додатку створіть ще один файл `main/urls.py`. Зробіть коміт із даними файлами;
    > Використовуйте можливості IntelliJ та її плагіній при створенні файлів, оберіть тип файлу `html` і далі вкіжіть його імя, IntelliJ автоматично згенерує темплейт файлу даного типу із початковим кодом.
1. Після створення додатку нам потрібно вказати Django frameworks його назву та де шукати веб сторінки. Це здійснюється у файлі `my_site/settings.py`у змінній `INSTALLED_APPS`, а також внесіть зміни у файл `my_site/url.py` (дивіться мої файли як зразок);
1. Далі переходимо до нашого додатку та займемся WEB сторінками. Для цього:
    - створимо сторінки двох типів - перша буде зчитуватись з `.html` темплейта. друга сторінка буде просто повертати відповідь у форматі JSON;
    - відкрийте та ознайомтесь із вмістом файла `main/views.py`. Для зручності я назвав функції відповідно до типу сторінок які вони будуть створювати (однак назва не головне);
     
1. Щоб поєднати функції із реальними URL шляхами за якими будуть доступні наші веб сторінки заповніть файл `main/urls.py` згідно мого зразка. Як можна зрозуміти з коду у нас є два URL посидання:
    - головна сторінка яка буде опрацьовуватись функцією `main`;
    - сторінка health/ яка буде опрацьована функцією `health`;
1. Запустіть сервер та переконайтесь що сторінки доступні. Виконайте коміт робочого Django сайту.
1. Роль моніторингу буде здійснювати файл `monitoring.py` який за допомогою бібліотеки `requests` буде опитувати сторінку `health`. Встановіть дану бібліотеку;
    ```bash
    pipenv install requests
    ```
1. Як видно із заготовленої функції health() відповідь формується як Пайтон словник і далі обробляється функцією JsonResponse(). У даній заготовці вже є сформована відповідь що містить декілька полів, наприклад `date` та `current_page`. Спробуйте відкрити сторінку `/health` у браузері (у більшості браузерів є JSON плагін який коректно відобразить дані).
1. Для здачі/захисту лабораторної потрібно зробити:
    1. модифікувати функцію `health` так щоб у відповіді були: згенерована на сервері дата, URL сторінки моніторингу, інформація про сервер на якому запущений сайт та інформація про клієнта який робить запит до сервера;
        > підказка: у програмі моніторингу є імпортовані бібліотеки `os` `datetime` а також змінна `request` можливо вони допоможуть :smirk:
    1. дописати функціонал який буде виводити повідомлення про недоступність сайту у випадку якщо WEB сторінка недоступна (як можна побачити функція requests.get() буде видавати помилку при недоступності сторінки);
        > спробуйте використати функції logging.error() та logger.warning()
    1. після запуску моніторингу запит йде лише один раз після чого програма закінчується - зробіть так щоб дана програма запускалась раз в хвилину та працювала в бекграунді (період запуску зробити через функціонал мови Python);
    1. спростіть роботу з пайтон середовищем через швидкий виклик довгих команд, для цього зверніть увагу на секцію `scripts` у Pipfile. Я додав аліас на запуск сервера який тепер буде стартувати за командою представленою нижче. Зробіть аліас на запус моніторингу:
        ```bash
        pipenv run server
        ```
1. Запустіть сервер та переконайтесь що головна сторінка відображається. Перейдіть у інше вікно консолі та запустіть програму моніторингу. Закомітьте файл логів `server.logs` до репозиторію. 
1. Після успішного виконання роботи відредагуйте Ваш персональний _README.md_ у цьому репозиторію. Створіть таблицю яка ставить у відповідність номер лабораторної роботи та URL посилання на папку з виконаною роботою у Вашому персональному репозиторію. Створіть пул-реквест до основного репозиторію.
